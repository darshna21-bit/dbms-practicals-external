CREATE DATABASE ScoreDB;
\c ScoreDB

CREATE TABLE StudentMarks (
    name VARCHAR(20),
    total_marks INT
);

CREATE TABLE StudentResult (
    roll_no INT PRIMARY KEY,
    name VARCHAR(20),
    class VARCHAR(20)
);

INSERT INTO StudentMarks VALUES 
('Suresh', 995), 
('Harish', 865), 
('Samart', 920), 
('Mohan', 1000), 
('Soham', 745);

INSERT INTO StudentResult(roll_no, name) VALUES 
(1, 'Suresh'), 
(2, 'Harish'), 
(3, 'Samart'), 
(4, 'Mohan'), 
(5, 'Soham');

CREATE OR REPLACE PROCEDURE proc_grade(r INT, OUT grade VARCHAR)
LANGUAGE plpgsql
AS $$
DECLARE 
    m INT;
BEGIN
    SELECT total_marks INTO m 
    FROM StudentMarks 
    WHERE name = (SELECT name FROM StudentResult WHERE roll_no = r);

    IF m BETWEEN 990 AND 1500 THEN
        grade := 'Distinction';
        UPDATE StudentResult SET class = 'Distinction' WHERE roll_no = r;

    ELSIF m BETWEEN 900 AND 989 THEN
        grade := 'FirstClass';
        UPDATE StudentResult SET class = 'FirstClass' WHERE roll_no = r;

    ELSIF m BETWEEN 825 AND 899 THEN
        grade := 'SecondClass';
        UPDATE StudentResult SET class = 'SecondClass' WHERE roll_no = r;

    ELSE
        grade := '--';
        UPDATE StudentResult SET class = '--' WHERE roll_no = r;
    END IF;

    RAISE NOTICE 'Student with Roll % has Grade: %', r, grade;
END;
$$;

CREATE OR REPLACE FUNCTION func_grade(r INT)
RETURNS VARCHAR
LANGUAGE plpgsql
AS $$
DECLARE 
    grade VARCHAR;
BEGIN
    CALL proc_grade(r, grade);
    RETURN grade;
END;
$$;

SELECT func_grade(1);
SELECT func_grade(2);
SELECT func_grade(3);
SELECT func_grade(4);
SELECT func_grade(5);

SELECT * FROM StudentResult;
