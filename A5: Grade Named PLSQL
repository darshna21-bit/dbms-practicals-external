Drop Table If Exists stud_marks;
Drop Table If Exists result;

Create Table stud_marks (
    roll_no Int,
    name Text,
    total_marks Int
);

Create Table result (
    roll_no Int,
    name Text,
    class Text
);

Insert Into stud_marks Values
(1, 'Ravi', 1200),
(2, 'Sneha', 950),
(3, 'Amit', 870);

-- Stored Function: fn_grade

Create Or Replace Function fn_grade(p_marks Int)
Returns Text
Language plpgsql
As $$
Declare
    v_class Text;
Begin
    If p_marks >= 990 And p_marks <= 1500 Then
        v_class := 'Distinction';
    Elsif p_marks >= 900 And p_marks <= 989 Then
        v_class := 'First Class';
    Elsif p_marks >= 825 And p_marks <= 899 Then
        v_class := 'Higher Second Class';
    Else
        v_class := 'Fail';
    End If;

    Return v_class;
End;
$$;

Select fn_grade(950);

-- Stored Procedure: proc_grade

Create Or Replace Procedure proc_grade(p_roll Int)
Language plpgsql
As $$
Declare
    v_name Text;
    v_marks Int;
    v_class Text;
Begin
    -- Get student details
    Select name, total_marks
    Into v_name, v_marks
    From stud_marks
    Where roll_no = p_roll;

    -- Get class using stored function
    v_class := fn_grade(v_marks);

    Insert Into result Values (p_roll, v_name, v_class);
    Raise Notice '% -> %', v_name, v_class;
End;
$$;

Call proc_grade(1);
Call proc_grade(2);
Call proc_grade(3);

Select * From result;
